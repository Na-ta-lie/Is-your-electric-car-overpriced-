---
title: "R Notebook"
output: html_notebook
---
About this file
Data Fields:

- Battery: The capacity of the vehicle's battery in kilowatt-hours (kWh).

- Car_name: The model name of the electric vehicle.

- Car_name_link: A direct link to the corresponding page on EV Database for more in-depth information.

- Efficiency: The energy efficiency rating of the vehicle in watt-hours per kilometer (Wh/km).

- Fast_charge: The fast-charging capability of the vehicle in minutes for a certain charging percentage.

- Price.DE.:The price of the electric vehicle in Germany.

- Range: The driving range of the vehicle on a single charge in kilometers.

- Top_speed:The maximum speed the vehicle can achieve in kilometers per hour.

- Acceleration..0.100.: The acceleration time from 0 to 100 kilometers per hour.
```{r}
library(dplyr)
library(ggplot2)
library(tidyr)
library(car)
library(MASS)
```
```{r}
ecars_raw = read.csv('EV_cars.csv')
ecars_raw
```

```{r}
#rename some of the columns
ecars_raw = ecars_raw %>% rename(Price = Price.DE., Acceleration = acceleration..0.100.)
```

```{r}

# extract the Make of each car into its own column
make = strsplit(ecars_raw$Car_name, split = ' ')

make_ = c()
n = length(make)

for (i in 1:n) {
  make_[i] = make[[i]][1]
}

ecars_raw$Make = make_
```

```{r}
# move columns so continuous variables are together 
ecars_raw = ecars_raw %>% relocate(Make, .before = Car_name_link)
ecars_raw = ecars_raw %>% relocate(Battery, .after = Car_name_link)
ecars_raw
```
```{r}
ecars = ecars_raw %>% filter(!is.na(Price))
ecars_missing_price = ecars_raw %>% filter(is.na(Price))
```

```{r}
ecars %>% group_by(Make) %>%
  filter(n() >= 10) %>%
  summarise(average_cost = mean(Price))

ecars %>% group_by(Make) %>%
  filter(n() >= 10) %>%
  summarise(average_cost = (mean(Price)/1000)) %>%
  ggplot(., aes(x = Make, y = average_cost)) +
  geom_col(aes(fill = Make)) + 
  ylab('Average cost in Germany in thousands of Eruros')+
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())
  

#ecars %>% group_by(Make)%>%
 # summarise(average_cost = mean(Price)) %>%
  #arrange(average_cost)
```



```{r}
unique(ecars$Make)
ecars %>% filter(Make == "e.Go")

```

```{r}
plot(ecars[,3:9])
plot(ecars$Acceleration, ecars$Battery)

ecars$Price_pow = (ecars$Price ** -.5)
ecars$Speed_pow = (ecars$Top_speed ** .25)
ecars$Efficiency_pow = (ecars$Efficiency ** .25)
summary(ecars)
sapply(ecars, sd)
hist(ecars$Price) 
hist(ecars$Price_pow) 
hist(ecars$Efficiency)
ecars
```
Colinearity with predicting Range based n battery

```{r}

RBmodel = lm(Range ~  Battery, data = ecars)
summary(RBmodel)
plot(RBmodel) 

PBmodel = lm(Price ~  Battery, data = ecars)
summary(PBmodel)
plot(PBmodel) 

ATmodel = lm(Top_speed ~ Acceleration, data = ecars)
summary(ATmodel)
plot(ATmodel)

model = lm(Price_pow ~ Efficiency_pow + Range + Speed_pow + Fast_charge, data = ecars)
summary(model) 
plot(model)

```
With transformation done to price 
```{r}
ecars_missing_price$Speed_pow = (ecars_missing_price$Top_speed ** .25)
ecars_missing_price$Efficiency_pow = (ecars_missing_price$Efficiency ** .25)
test = predict(model, ecars_missing_price, interval = 'prediction')
test_2_dollars = (1/(test))^2
ecars_missing_price
test_2_dollars
ecars_missing_price$predicted_price = (test_2_dollars[,1])
ecars_missing_price
```
```{r}
test2 = predict(model, ecars, interval = 'prediction')
test3 = predict(model, ecars, interval = 'confidence')
test2_2_dollars = (1/(test2))^2
test3_2_dollars = (1/(test3))^2
test2_2_dollars
test3_2_dollars
test2_2_dollarsnew = data.frame(Name = ecars$Car_name,
                 Make = ecars$Make,
                 Price = ecars$Price, 
                 Predicted_price = (test2_2_dollars[,1]),
                 Predicted_price_lwr = (test2_2_dollars[,2]),
                 Predicted_price_upr = (test2_2_dollars[,3]),
                 Confidence_price_lwr = (test3_2_dollars[,2]),
                 Confidence_price_upr = (test3_2_dollars[,3]))
test2_2_dollarsnew
```


```{r}
ggplot(data = test2_2_dollarsnew, aes(x = Predicted_price, y = Price)) +
  geom_point(aes(color = Make)) +
  geom_line(aes(x = Predicted_price, y = Predicted_price)) +
  geom_line(aes(x = Predicted_price, y = Predicted_price_lwr), col = 'red') +
  geom_line(aes(x = Predicted_price, y = Predicted_price_upr)) +
  geom_line(aes(x = Predicted_price, y = Confidence_price_lwr)) +
  geom_line(aes(x = Predicted_price, y = Confidence_price_upr))
  
  
new
```


```{r}
new %>% group_by(Make) %>%
  filter(n() >= 10) %>%
  summarise(average_cost = (mean(Price)/1000), average_predicted_cost = (mean(Predicted_price)/1000)) #%>%
  #ggplot(., aes(x = Make, y = average_predicted_cost)) +
  #geom_col(aes(fill = Make)) + 
  #ylab('Average cost in Germany in thousands of Eruros')+
  #theme(axis.title.x=element_blank(),
   #     axis.text.x=element_blank(),
    #    axis.ticks.x=element_blank())
```
```{r}
new %>% group_by(Make) %>%
  filter(n() >= 10) %>%
  summarise(average_price = (mean(Price)/1000), average_predicted_price = (mean(Predicted_price)/1000))%>%
  ggplot(., aes(x = average_predicted_price, y = average_price)) +
  geom_point(aes(color = Make), size =4) +
  geom_abline(intercept = 0, slope = 1) + 
  
```



```{r}
new
new %>% group_by(Make) %>%
  filter(n() >= 10) %>%
  summarise(average_price = (mean(Price)/1000), average_predicted_price = (mean(Predicted_price)/1000))%>%
  ggplot(., aes(x = average_predicted_price, y = average_price)) +
  geom_point(aes(color = Make), size =4) +
  geom_line(aes(x = average_predicted_price, y = average_predicted_price)) + 


```

```{r}
predict(model, newdata, interval = 'confidence')
predict(model, newdata, interval = 'prediction')
```


```{r}
new
new %>% group_by(Make) %>%
  filter(n() >= 10) %>%
  summarise(average_price = (mean(Price)/1000), average_predicted_price = (mean(Predicted_price)/1000))
```

```{r}
ecars_missing_price
pre
```


```{r}
model
```
















This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
